-- -------------------------separate folder and a new file for each manager

Sub SaveMe()

Application.ScreenUpdating = False

Dim MyReqTime As String          'Holds the Territory Manager "Code"
Dim MySavedPath As Variant   'Holds the path to save the file
Dim MyRecordedFileName As String    'Holds the file name
Dim MY As Integer       'Holds the year
Dim MM As Integer      'Holds the month
Dim MD As Integer        'Holds the day

MY = Year(Now)
 MM = Month(Now)
 MD = Day(Now)


MyReqTime = Left(ActiveSheet.Name, 4)
MySavedPath = Application.WorksheetFunction.VLookup(MyTm, Range("TMSavePath"), 2, False)


    ActiveSheet.Copy

    
    ActiveWorkbook.SaveAs Filename:= _
     MySavedPath & "\" & MY & MM & MD & "_" & ActiveSheet.Name & ".xlsx"
    
    
    
    ActiveWindow.Close

Application.ScreenUpdating = True

End Sub
--------------------------------------------------------------------

------ Extract values not found in the second list from the first list


Option Base 1   'Ensure Arrays begin at 1


Sub Test()
'Loading all the array at once

Dim Array1234() As Variant    'Declare the array
Dim RC As Integer     'Get the count of the rows of data
Dim x As Integer    'Loop to write data

    'Turn off screen updating (MUST be turned back on at the end)
    Application.ScreenUpdating = False
    'Turn off automatic calculation (MUST be turned back on at the end)
    Application.Calculation = xlCalculationManual
    
    'Clear old written data
    Range("D:E").ClearContents
    
    'Add start time (just for clocking the speed)
    Range("G1").Value = Time()


'Read the data
    'Load the array
    Array1234 = Range("A1").CurrentRegion
    
    'Get the count of rows in the array
    RC = UBound(Array1234)

'Write the data
    'Selet start of "write" range
    Range("D1").Select
    
    On Error Resume Next
        For x = 1 To RC
            If IsError _
                (WorksheetFunction.Match _
                (MyArray(x, 1), Range("MyNamedRange"), 0)) Then
                ActiveCell.Value = Array1234(x, 1)
                ActiveCell.Offset(0, 1).Value = Array1234(x, 2)
                ActiveCell.Offset(1, 0).Select
            Else
                'Do nothing
            End If
        Next x
    On Error GoTo 0


    'Add stop time
    Range("G2").Value = Time()
    
    'Turn autocalculate back on
    Application.Calculation = xlCalculationAutomatic
    
    'Turn screen updating back on
    Application.ScreenUpdating = False

End Sub


---------------------------------------------------------------------------------
-- save cell values as files in folder and then add within each file, separate file wihtin each folder 


Sub SavingMultipleSheets()

'Declare the variables
Dim MyTime As String              'Holds the territory manager
Dim MySavedPath As String        'Holds the path to save the file to
Dim Nameofthefile As String        'Holds the save file name (the new file)
Dim MW As String    'Holds the name of THIS workbook
Dim X As Integer                'A simple counter
Dim Replacedfile As String         'What we will look to replace to breat the links

'Test to ensure we're on row 1
If ActiveCell.Row <> 1 Then
    MsgBox "Please ensure you select the territory manager from row 1", _
        vbCritical, "Select from row 1"
    End
End If


'The first part...creating a new workbook with our first sheet...

'Get the territory manager
MyTime = ActiveCell.Value
'Build the file name for the new file
Nameofthefile = Year(Now) & Month(Now) & Day(Now) & " - " & ActiveCell.Value & ".xlsx"
'Build the save path based on which TM was selected
MySavedPath = Application.WorksheetFunction.VLookup(MyTime, Range("TMSavePath"), 2, False) & "\"
'Get the name of THIS workbook
MW = ThisWorkbook.Name

'Move down a row to get the first sheet name
ActiveCell.Offset(1, 0).Select

'Copy that sheet
Sheets(ActiveCell.Value).Copy
'...and save it using the path and file name we built above
ActiveWorkbook.SaveAs Filename:= _
        MySavedPath & Nameofthefile, FileFormat:= _
        xlOpenXMLWorkbook, CreateBackup:=False



'The second part...go back to our master file, and get the remaining sheets...

'Go back to the master sheet...
Workbooks(MW).Activate
'...and move down a row to get the next sheet to be copied
ActiveCell.Offset(1, 0).Select

'Loop with a test to see if we've reached a blank cell
Do While ActiveCell.Value <> ""
        '...if not, increase X by 1 (to use as the sheet index number)
        X = X + 1
        'Perform the copy and paste it to out new sheet
        Sheets(ActiveCell.Value).Copy After:=Workbooks(Nameofthefile).Sheets(X)
        'Return to the master file...
        Workbooks(MW).Activate
        '...and move down a row again
        ActiveCell.Offset(1, 0).Select
'...continue to loop until we've copied all the sheets in the list
Loop



'The third part...go to the new file, and sort out the link issue...

'Go to the new workbook
Workbooks(Nameofthefile).Activate

'Build string to search for (the master file name wrapped in square brackets)
MyReplace = "[" & MW & "]"

'Loop through each sheet in the new workbook
For X = 1 To Sheets.Count
    
    'Select the sheet by its index number...
    Sheets(X).Select
    '...select all the cells
    Cells.Select
    
    'Replace our search string with blank...
    Selection.Replace What:=MyReplace, Replacement:="", LookAt:= _
        xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
    'Go to A1 (just to be tidy)
    Range("A1").Select
'Repeat loop
Next X



'The final part...go to the first sheet, then save and close

'Go to first sheet
Sheets(1).Select

'Turn off alerts (to avoid being asked if we want to save the file)
Application.DisplayAlerts = False
    
'Save the file
ActiveWorkbook.SaveAs Filename:= _
        MySavedPath & Nameofthefile, FileFormat:= _
        xlOpenXMLWorkbook, CreateBackup:=False
'Close the file
ActiveWindow.Close

'Turn the alerts back on
Application.DisplayAlerts = True

End Sub



